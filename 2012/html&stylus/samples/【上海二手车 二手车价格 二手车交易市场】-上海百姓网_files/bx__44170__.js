(function(){var e=document,d=window,c={},b=function(h,f){var j,g=/^http:\/\//.test(h)?h:"http://static.baixing.net"+h,i=e.getElementsByTagName("script")[0];if(c[g]){if(typeof(f)=="object"){a(f);}return;}j=e.createElement("script");j.setAttribute("async",true);j.setAttribute("type","text/javascript");j.setAttribute("src",g);j.onload=j.onreadystatechange=function(){if(!this.readyState||this.readyState==="loaded"||this.readyState==="complete"){c[this.getAttribute("src")]=true;if(typeof(f)=="object"){a(f);}j.onload=j.onreadystatechange=null;}};i.parentNode.insertBefore(j,i);},a=function(f){if(typeof(f)=="function"){return f.call();}if(typeof(f[0])=="function"){return f[0].call();}if(f.length){b(f.shift(),f);}};this.bx=function(f){f.push=a;a([function(){if(f.length){for(var g=0;g<f.length;g++){a(f[g]);}}}]);};})();bx(_bx);function dump(a){if(typeof(console)=="object"){console.log(a);}}function bxTips(d,c){var b=d;var a=c||2000;_bx.push(function(){jQuery("#bxTips span").html(b);jQuery("#bxTips").show();window.setTimeout(function(){jQuery("#bxTips").fadeOut(1000);},a);});}_bx.push(function(){$("body").on("blur",'input[name="mobile"]',function(){var a=$(this);if($('#ajaxlogin input[name="type"]').val()==="reg"){var b=a.val();if(!/^1(3|4|5|8)\d{9}$/.test(b)){a.next("small").html("请填写正确的手机号码。");return;}$.getJSON("/pages/mobilecheck.php?mobile="+encodeURIComponent(b),function(c){if(c.code){a.next("small").html('该手机号码已经注册过，<a href="javascript:void(0)" class="switchButton" data-type="login">点此登录</a>');return;}});}a.next("small").html("");});});~function(){var b=b||{},a=$("[data-toggle=async]");b._request=function(g,e){var d=e.url,j=e.callback,h=e.data,f=e.eventType,i=e.method.toLowerCase(),c=e.preventDefault;g.on(f,function(l){!c||l.preventDefault();if(!d){return b._error(g,j);}h=typeof h==="function"?h():h;var k=$[i](d,h,function(m){g.trigger("async_before");j&&j.call(this,m);g.trigger("async_success",m);g.trigger("async_after",m);});k.error(function(){b._error(g,j);});});};b._defaultOptions={data:{},eventType:"click",method:"get",preventDefault:1};b._error=function(c,d){c.trigger("async_before");d&&d.call(null,"");c.trigger("async_error");c.trigger("async_after");};$.fn.async=function(c){this.each(function(d,e){e=$(e);c.url=c.url||e.data("target")||e.attr("href");c.callback=c.callback;c=$.extend(1,b._defaultOptions,c);b._request(e,c);});};a.length&&a.each(function(d,e){var c=$.extend(1,b._defaultOptions,{url:$(this).data("target")||$(this).attr("href")});b._request($(this),c);});}(jQuery);~function(b){var a=a||{};a.defaultOptions={url:"/ajax/auth/deal/"};b.auth=function(d){var d=b.extend(d,a.defaultOptions),c=d.url,e=d.data,f=d.callback;b.post(c,e,function(g){f&&f.call(this,g);},"json");};}(jQuery);~function($){var auth=auth||{},tmpModal;auth.modal=function(options){var data=options.data,callback=options.callback,mobile=options.mobile;if($(".modal.in").attr("id")!=="modal-ajax"){tmpModal=$(".modal.in");}$("#modal-ajax").modal("hide").remove();$("body").append('<div class="modal hide" id="modal-ajax">\n				<h4 class="modal-title">'+data.title+'</h4>\n				<a class="close" data-dismiss="modal" href="###">&times;</a>\n				<div class="modal-content">'+data.description+"<p class=typo></p></div>\n			</div>");$("#modal-ajax .switchButton").each(function(){$(this).async({method:"get",callback:function(data){auth.modal($.extend(options,{data:$.parseJSON(data)}));return false;}});});tmpModal&&tmpModal.modal("hide");$("#modal-ajax").modal("show");callback&&callback();if(data.script){try{eval(data.script);}catch(e){}}};auth.check=function(options){var callback=options.callback,data=options.data,mobile=options.mobile;var url="/ajax/auth/deal/?mobile="+encodeURIComponent(mobile);if((typeof(callback)).toLowerCase()!=="function"){callback=false;}if(readCookie("__u")){callback&&callback();return false;}$.get(url,function(res){if(!data){data=res;}auth.modal({data:data,mobile:mobile,callback:function(){$("#modal-ajax").find("form").eq(0).submit(function(e){e.preventDefault();$.auth({data:$("#modal-ajax form").eq(0).serialize(),callback:function(data){if(data.success===1){$("#modal-ajax").modal("hide").remove();callback&&callback();tmpModal.modal("show");}else{auth.check({data:data,callback:callback});}return false;}});return false;});}});},"json");};$.authCheck=function(options){auth.check(options);};$("body").on("submit","form[data-toggle=auth]",function(e){var $this=$(e.target);e.preventDefault();var action=$this.attr("action").replace(/view=1/,"view=0")+"&r="+Math.floor(Math.random()*100000);var ajaxFunction=function(){$btn=$this.find("input[type=submit]");$msg=$this.find(".error-message");$this.find(".error").remove();var btnValue=$btn.attr("value");$btn.attr("disabled","1").attr("value","提交中，请稍候...");$msg.html('<img src="http://static.baixing.net/images/bar.gif" style="vertical-align:middle"/>').show();var format=(action.indexOf("format=txt")==-1)?"json":"html";$.post(action,$this.serializeArray(),function(data){$btn.attr("value",btnValue).removeAttr("disabled");$msg.html("").hide();if($this.data("callback")){eval($this.data("callback")+"(data, $this)");}else{if(!data.success){$this.find(".error-message").html(data.title).show();var $field=$("#"+$this.attr("id")+"_"+data.script);if($field.length){$field.find(".error").remove();$field.append('<cite class="red p-note error"> '+data.title+"</cite>");$(window).scrollTop($field.offset().top-20);}}else{auth.modal({data:data});}}},format);};$.authCheck({callback:ajaxFunction});return false;});$("body").on("click","a[data-toggle=auth]",function(e){var $this=$(e.target);e.preventDefault();var href=$this.attr("href").replace(/view=1/,"view=0")+"&r="+Math.floor(Math.random()*100000);if(href.indexOf("view=0")==-1){return true;}var format=(href.indexOf("format=txt")==-1)?"json":"html";var ajaxFunction=function(){$.get(href,function(data){if($this.data("callback")){eval($this.data("callback")+"(data, $this)");}else{auth.modal({data:data});}},format);};$.authCheck({callback:ajaxFunction});return false;});}(jQuery);var Ajax={inited:false,getAjaxUrl:function(a){return a.replace(/view=1/,"view=0")+"&r="+Math.floor(Math.random()*100000);},init:function(){if(Ajax.inited){return;}Ajax.inited=true;var $=jQuery;$("body").on("submit","form.ajax",function(e){var $this=$(e.target);if($this.attr("data-toggle")=="auth"){return;}var action=Ajax.getAjaxUrl($this.attr("action"));var ajaxFunction=function(){$btn=$this.find("input[type=submit]");$msg=$this.find(".error-message");$this.find(".error").remove();var btnValue=$btn.attr("value");$btn.attr("disabled","1").attr("value","提交中，请稍候...");$msg.html('<img src="http://static.baixing.net/images/bar.gif" style="vertical-align:middle"/>').show();var format=(action.indexOf("format=txt")==-1)?"json":"html";$.post(action,$this.serializeArray(),function(data){$btn.attr("value",btnValue).removeAttr("disabled");$msg.html("").hide();if($this.data("callback")){eval($this.data("callback")+"(data, $this)");}else{if(!data.success){$this.find(".error-message").html(data.title).show();var $field=$("#"+$this.attr("id")+"_"+data.script);if($field.length){$field.find(".error").remove();$field.append('<cite class="red p-note error"> '+data.title+"</cite>");$(window).scrollTop($field.offset().top-20);}}else{Ajax.modal(data);}}},format);};Ajax.call(ajaxFunction,action,$this);return false;});$("body").on("click","a.ajax",function(e){var $this=$(e.target);if($this.attr("data-toggle")=="auth"){return;}var href=Ajax.getAjaxUrl($this.attr("href"));if(href.indexOf("view=0")==-1){return true;}var format=(href.indexOf("format=txt")==-1)?"json":"html";var ajaxFunction=function(){$.get(href,function(data){if($this.data("callback")){eval($this.data("callback")+"(data, $this)");}else{Ajax.modal(data);}},format);};Ajax.call(ajaxFunction,href,$this);return false;});},call:function(d,c,a){if(c.indexOf("login=")!=-1){var f=readCookie("__u");var g=0;var e;var b=null;if(c.indexOf("login=1")!=-1&&f==null){g=1;if(a[0].tagName.toLowerCase()=="form"){e=a.find("input[name=mobile]").val();}}else{if(c.indexOf("login=2")!=-1&&f==null){g=2;if(a[0].tagName.toLowerCase()=="form"){b=a;e=b.find("input[name=mobile]").val();}}}if(g&&!$.authCheck({mobile:e,callback:d})){return false;}}d();},modal:function modal(data){var $=jQuery;if(!data){return false;}var $i=0;var $class="";var $action="";var $btn="";for(key in data.action){$i++;$class=($i==1)?'class="button button-green button-medium ajax"':'class="ajax button button-grey button-medium ajax"';$action=data.action[key];if($action instanceof Object){if(!$action.href){$btn+="<a "+$class+$action.javascript+'="'+$action[$action.javascript]+'" target="_self">'+key+"</a> ";}else{$btn+="<a "+$class+' href="'+$action.href+'" '+$action.javascript+'="'+$action[$action.javascript]+'" target="_self">'+key+"</a> ";}}else{if($action==window.location.href){$action="javascript:void($('#modal-ajax').modal('hide'));";}$btn+="<a "+$class+' href="'+$action+'" target="_self">'+key+"</a> ";}}$("#modal-ajax").modal("hide");$("#modal-ajax").remove();$("body").append('<div class="modal hide" id="modal-ajax">\n				<h4 class="modal-title">'+data.title+'</h4>\n				<a class="close" data-dismiss="modal" href="###">&times;</a>\n				<div class="modal-content">'+data.description+"<p class=typo>"+$btn+"</p></div>\n			</div>");$("#modal-ajax").modal("show");if(data.script){try{eval(data.script);}catch(e){}}},auth:function(e,b){if(readCookie("__u")&&e){return e();}var d=jQuery;var a={};var c;if(d("#ajaxlogin").length){c=d("#ajaxlogin");a.type=c.find("input[name=type]").val();a.password=c.find("input[name=password]").val();a.repassword=c.find("input[name=repassword]").val();a.validCode=c.find("input[name=validCode]").val();}if(!a.mobile&&b){a.mobile=b;}if(a.mobile==null){a.mobile="";}d.post("/ajax/auth/deal/",a,function(i){if(!i.success){if(d(".modal.in").attr("id")!=="modal-ajax"){tmpModal=d(".modal.in").modal("hide");}var g,f;if(i.title=="登录"){g="";f="active";}else{g="active";f="";}var h='<ul class="tab-title clearfix"><li class="tab-title-item '+f+'"><a hidefocus class="switchButton" href="javascript:void(0);" data-toggle="tab" data-type="login">登录</a></li><li class="tab-title-item tab-title-item-last '+g+'"><a hidefocus class="switchButton" href="javascript:void(0);" data-toggle="tab" data-type="reg">注册</a></li></ul>';i.description='<div id="ajaxlogin">'+h+i.description+"</div>";i.title="您需要先注册/登录";Ajax.modal(i);d("#ajaxlogin").on("click",".switchButton",function(k){c=d("#ajaxlogin");var j=c.find("input[name=type]");j.val(d(this).data("type"));Ajax.auth(e,a.mobile);return false;});d("#ajaxlogin form").on("submit",function(j){Ajax.auth(e,b);j.preventDefault();});}else{d("#modal-ajax").modal("hide");tmpModal&&tmpModal.modal("show");if(e){e();}}},"json");}};_bx.push(function(){jQuery(document).ready(function(){Ajax.init();});});